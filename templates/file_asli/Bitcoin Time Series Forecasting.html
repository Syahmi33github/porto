<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>8850fdfb719b416498e192e19f1eef64</title>
    <style>
      html {
        line-height: 1.5;
        font-family: Georgia, serif;
        font-size: 20px;
        color: #1a1a1a;
        background-color: #fdfdfd;
      }
      body {
        margin: 0 auto;
        max-width: 36em;
        padding-left: 50px;
        padding-right: 50px;
        padding-top: 50px;
        padding-bottom: 50px;
        hyphens: auto;
        overflow-wrap: break-word;
        text-rendering: optimizeLegibility;
        font-kerning: normal;
      }
      @media (max-width: 600px) {
        body {
          font-size: 0.9em;
          padding: 1em;
        }
        h1 {
          font-size: 1.8em;
        }
      }
      @media print {
        body {
          background-color: transparent;
          color: black;
          font-size: 12pt;
        }
        p,
        h2,
        h3 {
          orphans: 3;
          widows: 3;
        }
        h2,
        h3,
        h4 {
          page-break-after: avoid;
        }
      }
      p {
        margin: 1em 0;
      }
      a {
        color: #1a1a1a;
      }
      a:visited {
        color: #1a1a1a;
      }
      img {
        max-width: 100%;
      }
      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin-top: 1.4em;
      }
      h5,
      h6 {
        font-size: 1em;
        font-style: italic;
      }
      h6 {
        font-weight: normal;
      }
      ol,
      ul {
        padding-left: 1.7em;
        margin-top: 1em;
      }
      li > ol,
      li > ul {
        margin-top: 0;
      }
      blockquote {
        margin: 1em 0 1em 1.7em;
        padding-left: 1em;
        border-left: 2px solid #e6e6e6;
        color: #606060;
      }
      code {
        font-family: Menlo, Monaco, "Lucida Console", Consolas, monospace;
        font-size: 85%;
        margin: 0;
      }
      pre {
        margin: 1em 0;
        overflow: auto;
      }
      pre code {
        padding: 0;
        overflow: visible;
        overflow-wrap: normal;
      }
      .sourceCode {
        background-color: transparent;
        overflow: visible;
      }
      hr {
        background-color: #1a1a1a;
        border: none;
        height: 1px;
        margin: 1em 0;
      }
      table {
        margin: 1em 0;
        border-collapse: collapse;
        width: 100%;
        overflow-x: auto;
        display: block;
        font-variant-numeric: lining-nums tabular-nums;
      }
      table caption {
        margin-bottom: 0.75em;
      }
      tbody {
        margin-top: 0.5em;
        border-top: 1px solid #1a1a1a;
        border-bottom: 1px solid #1a1a1a;
      }
      th {
        border-top: 1px solid #1a1a1a;
        padding: 0.25em 0.5em 0.25em 0.5em;
      }
      td {
        padding: 0.125em 0.5em 0.25em 0.5em;
      }
      header {
        margin-bottom: 4em;
        text-align: center;
      }
      #TOC li {
        list-style: none;
      }
      #TOC ul {
        padding-left: 1.3em;
      }
      #TOC > ul {
        padding-left: 0;
      }
      #TOC a:not(:hover) {
        text-decoration: none;
      }
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      div.columns {
        display: flex;
        gap: min(4vw, 1.5em);
      }
      div.column {
        flex: auto;
        overflow-x: auto;
      }
      div.hanging-indent {
        margin-left: 1.5em;
        text-indent: -1.5em;
      }
      ul.task-list {
        list-style: none;
      }
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1.6em;
        vertical-align: middle;
      }
      pre > code.sourceCode {
        white-space: pre;
        position: relative;
      }
      pre > code.sourceCode > span {
        display: inline-block;
        line-height: 1.25;
      }
      pre > code.sourceCode > span:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode > span {
        color: inherit;
        text-decoration: inherit;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        pre > code.sourceCode {
          white-space: pre-wrap;
        }
        pre > code.sourceCode > span {
          text-indent: -5em;
          padding-left: 5em;
        }
      }
      pre.numberSource code {
        counter-reset: source-line 0;
      }
      pre.numberSource code > span {
        position: relative;
        left: -4em;
        counter-increment: source-line;
      }
      pre.numberSource code > span > a:first-child::before {
        content: counter(source-line);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      /* div.sourceCode
      {   } */
      @media screen {
        pre > code.sourceCode > span > a:first-child::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
        color: #008000;
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      /* code span.ex { } Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
        color: #008000;
        font-weight: bold;
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
      .display.math {
        display: block;
        text-align: center;
        margin: 0.5rem auto;
      }
    </style>
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <section
      id="bitcoin-time-series-forecasting-with-rnn--lstm"
      class="cell markdown"
      id="vY5Uuyra82_2"
    >
      <h1>Bitcoin Time Series Forecasting with RNN &amp; LSTM</h1>
    </section>
    <section id="project-overview" class="cell markdown" id="ZqAyFbVV-mof">
      <h2>Project Overview</h2>
    </section>
    <div class="cell markdown" id="7aM_HRq5-4t9">
      <p>
        Bitcoin adalah cryptocurrency paling lama berjalan dan paling terkenal,
        pertama kali dirilis sebagai open source pada tahun 2009 oleh Satoshi
        Nakamoto anonim. Bitcoin berfungsi sebagai media pertukaran digital yang
        terdesentralisasi, dengan transaksi diverifikasi dan dicatat dalam buku
        besar yang didistribusikan secara publik (blockchain) tanpa memerlukan
        otoritas pencatatan tepercaya atau perantara pusat. Blok transaksi
        berisi hash kriptografi SHA-256 dari blok transaksi sebelumnya, dan
        dengan demikian "dirantai" bersama, berfungsi sebagai catatan abadi dari
        semua transaksi yang pernah terjadi. Seperti halnya mata uang/komoditas
        apa pun di pasar, perdagangan bitcoin dan instrumen keuangan segera
        mengikuti adopsi bitcoin oleh publik dan terus berkembang. Jika Anda
        belum mengetahui apa itu Bitcoin, maka dapatkan beberapa pengetahuan
        tentang Bitcoin di sini.
      </p>
    </div>
    <section id="import-data--module" class="cell markdown" id="SpKMytDJ4Zv-">
      <h2>IMPORT DATA &amp; MODULE</h2>
    </section>
    <section
      id="load-data-menggunakan-api-kaggle"
      class="cell markdown"
      id="NSqZlgwH5Okh"
    >
      <h3>Load data menggunakan API KAGGLE</h3>
    </section>
    <div
      class="cell code"
      data-execution_count="1"
      data-colab='{"base_uri":"https://localhost:8080/","height":88}'
      id="N-qXVfqL1oys"
      data-outputId="05012bdd-8d4b-4e33-862e-c85a2c125d6c"
    >
      <div class="sourceCode" id="cb1">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># C:\Users\USER\.kaggle</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> files</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>files.upload()</span></code></pre>
      </div>
      <div class="output display_data">
        <input
          type="file"
          id="files-f0cc2c99-ffdf-412c-b790-9faa2ec5df1d"
          name="files[]"
          multiple
          disabled
          style="border: none"
        />
        <output id="result-f0cc2c99-ffdf-412c-b790-9faa2ec5df1d">
          Upload widget is only available when the cell has been executed in the
          current browser session. Please rerun this cell to enable.
        </output>
        <script>
          // Copyright 2017 Google LLC
          //
          // Licensed under the Apache License, Version 2.0 (the "License");
          // you may not use this file except in compliance with the License.
          // You may obtain a copy of the License at
          //
          //      http://www.apache.org/licenses/LICENSE-2.0
          //
          // Unless required by applicable law or agreed to in writing, software
          // distributed under the License is distributed on an "AS IS" BASIS,
          // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
          // See the License for the specific language governing permissions and
          // limitations under the License.

          /**
           * @fileoverview Helpers for google.colab Python module.
           */
          (function (scope) {
            function span(text, styleAttributes = {}) {
              const element = document.createElement("span");
              element.textContent = text;
              for (const key of Object.keys(styleAttributes)) {
                element.style[key] = styleAttributes[key];
              }
              return element;
            }

            // Max number of bytes which will be uploaded at a time.
            const MAX_PAYLOAD_SIZE = 100 * 1024;

            function _uploadFiles(inputId, outputId) {
              const steps = uploadFilesStep(inputId, outputId);
              const outputElement = document.getElementById(outputId);
              // Cache steps on the outputElement to make it available for the next call
              // to uploadFilesContinue from Python.
              outputElement.steps = steps;

              return _uploadFilesContinue(outputId);
            }

            // This is roughly an async generator (not supported in the browser yet),
            // where there are multiple asynchronous steps and the Python side is going
            // to poll for completion of each step.
            // This uses a Promise to block the python side on completion of each step,
            // then passes the result of the previous step as the input to the next step.
            function _uploadFilesContinue(outputId) {
              const outputElement = document.getElementById(outputId);
              const steps = outputElement.steps;

              const next = steps.next(outputElement.lastPromiseValue);
              return Promise.resolve(next.value.promise).then((value) => {
                // Cache the last promise value to make it available to the next
                // step of the generator.
                outputElement.lastPromiseValue = value;
                return next.value.response;
              });
            }

            /**
             * Generator function which is called between each async step of the upload
             * process.
             * @param {string} inputId Element ID of the input file picker element.
             * @param {string} outputId Element ID of the output display.
             * @return {!Iterable<!Object>} Iterable of next steps.
             */
            function* uploadFilesStep(inputId, outputId) {
              const inputElement = document.getElementById(inputId);
              inputElement.disabled = false;

              const outputElement = document.getElementById(outputId);
              outputElement.innerHTML = "";

              const pickedPromise = new Promise((resolve) => {
                inputElement.addEventListener("change", (e) => {
                  resolve(e.target.files);
                });
              });

              const cancel = document.createElement("button");
              inputElement.parentElement.appendChild(cancel);
              cancel.textContent = "Cancel upload";
              const cancelPromise = new Promise((resolve) => {
                cancel.onclick = () => {
                  resolve(null);
                };
              });

              // Wait for the user to pick the files.
              const files = yield {
                promise: Promise.race([pickedPromise, cancelPromise]),
                response: {
                  action: "starting",
                },
              };

              cancel.remove();

              // Disable the input element since further picks are not allowed.
              inputElement.disabled = true;

              if (!files) {
                return {
                  response: {
                    action: "complete",
                  },
                };
              }

              for (const file of files) {
                const li = document.createElement("li");
                li.append(span(file.name, { fontWeight: "bold" }));
                li.append(
                  span(
                    `(${file.type || "n/a"}) - ${file.size} bytes, ` +
                      `last modified: ${
                        file.lastModifiedDate
                          ? file.lastModifiedDate.toLocaleDateString()
                          : "n/a"
                      } - `
                  )
                );
                const percent = span("0% done");
                li.appendChild(percent);

                outputElement.appendChild(li);

                const fileDataPromise = new Promise((resolve) => {
                  const reader = new FileReader();
                  reader.onload = (e) => {
                    resolve(e.target.result);
                  };
                  reader.readAsArrayBuffer(file);
                });
                // Wait for the data to be ready.
                let fileData = yield {
                  promise: fileDataPromise,
                  response: {
                    action: "continue",
                  },
                };

                // Use a chunked sending to avoid message size limits. See b/62115660.
                let position = 0;
                do {
                  const length = Math.min(
                    fileData.byteLength - position,
                    MAX_PAYLOAD_SIZE
                  );
                  const chunk = new Uint8Array(fileData, position, length);
                  position += length;

                  const base64 = btoa(String.fromCharCode.apply(null, chunk));
                  yield {
                    response: {
                      action: "append",
                      file: file.name,
                      data: base64,
                    },
                  };

                  let percentDone =
                    fileData.byteLength === 0
                      ? 100
                      : Math.round((position / fileData.byteLength) * 100);
                  percent.textContent = `${percentDone}% done`;
                } while (position < fileData.byteLength);
              }

              // All done.
              yield {
                response: {
                  action: "complete",
                },
              };
            }

            scope.google = scope.google || {};
            scope.google.colab = scope.google.colab || {};
            scope.google.colab._files = {
              _uploadFiles,
              _uploadFilesContinue,
            };
          })(self);
        </script>
      </div>
      <div class="output stream stdout">
        <pre><code>Saving kaggle.json to kaggle.json
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="1">
        <pre><code>{&#39;kaggle.json&#39;: b&#39;{&quot;username&quot;:&quot;syahmisajid12&quot;,&quot;key&quot;:&quot;a76cee502ebc4268b9b384c1c587dfe1&quot;}&#39;}</code></pre>
      </div>
    </div>
    <div class="cell code" data-execution_count="2" id="hZ4c9mSX5LuW">
      <div class="sourceCode" id="cb4">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir <span class="op">~/</span>.kaggle</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cp kaggle.json <span class="op">~/</span>.kaggle<span class="op">/</span></span></code></pre>
      </div>
    </div>
    <div class="cell markdown" id="sD6IGqR07JO4">
      <p>Load Data dari Kaggle</p>
    </div>
    <div
      class="cell code"
      data-execution_count="3"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="A4KJjvQL7DbM"
      data-outputId="62de2400-5675-4623-ce64-72912e7d18c4"
    >
      <div class="sourceCode" id="cb5">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle datasets download <span class="op">-</span>d mczielinski<span class="op">/</span>bitcoin<span class="op">-</span>historical<span class="op">-</span>data</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>Warning: Your Kaggle API key is readable by other users on this system! To fix this, you can run &#39;chmod 600 /root/.kaggle/kaggle.json&#39;
Downloading bitcoin-historical-data.zip to /content
 82% 82.0M/100M [00:00&lt;00:00, 85.6MB/s]
100% 100M/100M [00:01&lt;00:00, 102MB/s]  
</code></pre>
      </div>
    </div>
    <div class="cell markdown" id="VHSpJgR1Wkng">
      <p>Import Module</p>
    </div>
    <div class="cell code" data-execution_count="4" id="SXf3mJc37LvO">
      <div class="sourceCode" id="cb7">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre>
      </div>
    </div>
    <div class="cell markdown" id="EKsxikumWnVL">
      <p>Import Function</p>
    </div>
    <div
      class="cell code"
      data-execution_count="5"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="-D6ZGvMT7ORk"
      data-outputId="9a400972-ddd0-4a6d-f28b-2d05c405854c"
    >
      <div class="sourceCode" id="cb8">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get helper_functions.py script from course GitHub</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wget https:<span class="op">//</span>raw.githubusercontent.com<span class="op">/</span>Syahmi33github<span class="op">/</span>Emotion<span class="op">-</span>Classification<span class="op">/</span>main<span class="op">/</span>helper_functions.py</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import helper functions we&#39;re going to use</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> helper_functions <span class="im">import</span> unzip_data</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>--2023-06-24 12:22:23--  https://raw.githubusercontent.com/Syahmi33github/Emotion-Classification/main/helper_functions.py
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.111.133, 185.199.109.133, 185.199.108.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.111.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 11485 (11K) [text/plain]
Saving to: ‘helper_functions.py’


helper_functions.py   0%[                    ]       0  --.-KB/s               
helper_functions.py 100%[===================&gt;]  11.22K  --.-KB/s    in 0s      

2023-06-24 12:22:24 (75.3 MB/s) - ‘helper_functions.py’ saved [11485/11485]

</code></pre>
      </div>
    </div>
    <section
      id="exploratory-data-analysis"
      class="cell markdown"
      id="68sz8Z657VBU"
    >
      <h2>Exploratory Data Analysis</h2>
    </section>
    <div class="cell code" data-execution_count="6" id="7QoyHMcf7SPC">
      <div class="sourceCode" id="cb10">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>unzip_data(<span class="st">&quot;/content/bitcoin-historical-data.zip&quot;</span>)</span></code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="7"
      data-colab='{"base_uri":"https://localhost:8080/","height":206}'
      id="rqvupOKL7eR1"
      data-outputId="7c0976d0-eda6-495d-c321-d0be8413217d"
    >
      <div class="sourceCode" id="cb11">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">&#39;/content/bitstampUSD_1-min_data_2012-01-01_to_2021-03-31.csv&#39;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="7">
        <div id="df-69c690e6-979f-4974-97db-dfe4ff1a7b7a">
          <div class="colab-df-container">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right">
                    <th></th>
                    <th>Timestamp</th>
                    <th>Open</th>
                    <th>High</th>
                    <th>Low</th>
                    <th>Close</th>
                    <th>Volume_(BTC)</th>
                    <th>Volume_(Currency)</th>
                    <th>Weighted_Price</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>0</th>
                    <td>1325317920</td>
                    <td>4.39</td>
                    <td>4.39</td>
                    <td>4.39</td>
                    <td>4.39</td>
                    <td>0.455581</td>
                    <td>2.0</td>
                    <td>4.39</td>
                  </tr>
                  <tr>
                    <th>1</th>
                    <td>1325317980</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                  </tr>
                  <tr>
                    <th>2</th>
                    <td>1325318040</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                  </tr>
                  <tr>
                    <th>3</th>
                    <td>1325318100</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                  </tr>
                  <tr>
                    <th>4</th>
                    <td>1325318160</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                    <td>NaN</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button
              class="colab-df-convert"
              onclick="convertToInteractive('df-69c690e6-979f-4974-97db-dfe4ff1a7b7a')"
              title="Convert this dataframe to an interactive table."
              style="display: none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 0 24 24"
                width="24px"
              >
                <path d="M0 0h24v24H0V0z" fill="none" />
                <path
                  d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"
                />
                <path
                  d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"
                />
              </svg>
            </button>

            <style>
              .colab-df-container {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
              }

              .colab-df-convert {
                background-color: #e8f0fe;
                border: none;
                border-radius: 50%;
                cursor: pointer;
                display: none;
                fill: #1967d2;
                height: 32px;
                padding: 0 0 0 0;
                width: 32px;
              }

              .colab-df-convert:hover {
                background-color: #e2ebfa;
                box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3),
                  0px 1px 3px 1px rgba(60, 64, 67, 0.15);
                fill: #174ea6;
              }

              [theme="dark"] .colab-df-convert {
                background-color: #3b4455;
                fill: #d2e3fc;
              }

              [theme="dark"] .colab-df-convert:hover {
                background-color: #434b5c;
                box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
                filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
                fill: #ffffff;
              }
            </style>

            <script>
              const buttonEl = document.querySelector(
                "#df-69c690e6-979f-4974-97db-dfe4ff1a7b7a button.colab-df-convert"
              );
              buttonEl.style.display = google.colab.kernel.accessAllowed
                ? "block"
                : "none";

              async function convertToInteractive(key) {
                const element = document.querySelector(
                  "#df-69c690e6-979f-4974-97db-dfe4ff1a7b7a"
                );
                const dataTable = await google.colab.kernel.invokeFunction(
                  "convertToInteractive",
                  [key],
                  {}
                );
                if (!dataTable) return;

                const docLinkHtml =
                  "Like what you see? Visit the " +
                  '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>' +
                  " to learn more about interactive tables.";
                element.innerHTML = "";
                dataTable["output_type"] = "display_data";
                await google.colab.output.renderOutput(dataTable, element);
                const docLink = document.createElement("div");
                docLink.innerHTML = docLinkHtml;
                element.appendChild(docLink);
              }
            </script>
          </div>
        </div>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="8"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="fKKSCKf37qsV"
      data-outputId="3b515d70-fd92-4bf5-a6fc-70f7b80082a4"
    >
      <div class="sourceCode" id="cb12">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="8">
        <pre><code>Index([&#39;Timestamp&#39;, &#39;Open&#39;, &#39;High&#39;, &#39;Low&#39;, &#39;Close&#39;, &#39;Volume_(BTC)&#39;,
       &#39;Volume_(Currency)&#39;, &#39;Weighted_Price&#39;],
      dtype=&#39;object&#39;)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="9"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="Q9cgbF4M7vAU"
      data-outputId="884d37cc-12ee-4788-db01-569eefd805e9"
    >
      <div class="sourceCode" id="cb14">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="9">
        <pre><code>(4857377, 8)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="10"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="UxeGXxYa8tjf"
      data-outputId="dbec8610-db52-4b3e-f6df-f20833ba246b"
    >
      <div class="sourceCode" id="cb16">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bit_data <span class="op">=</span> df.copy()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>bit_data[<span class="st">&quot;date&quot;</span>]<span class="op">=</span>pd.to_datetime(bit_data[<span class="st">&quot;Timestamp&quot;</span>],unit<span class="op">=</span><span class="st">&quot;s&quot;</span>).dt.date</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>group<span class="op">=</span>bit_data.groupby(<span class="st">&quot;date&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>group[<span class="st">&quot;Close&quot;</span>].mean()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>)</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="10">
        <pre><code>date
2011-12-31    4.482500
2012-01-01    4.806667
2012-01-02    5.000000
2012-01-03    5.252500
2012-01-04    5.223333
2012-01-05    6.286190
2012-01-06    6.445000
2012-01-07    6.800000
2012-01-08    6.950000
2012-01-09    6.581667
Name: Close, dtype: float64</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="11"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="uJVLnBpu--Q6"
      data-outputId="23db53e0-2b77-43d2-9be1-302d911f2c90"
    >
      <div class="sourceCode" id="cb18">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="11">
        <pre><code>(3376,)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="12"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="35CU4KZOC06J"
      data-outputId="01078858-efde-4510-cbd7-819f5ec2bbed"
    >
      <div class="sourceCode" id="cb20">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data.isnull().<span class="bu">sum</span>()</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="12">
        <pre><code>0</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="13"
      data-colab='{"base_uri":"https://localhost:8080/","height":643}'
      id="FkUqXNXVLx8-"
      data-outputId="0e42e3a6-ecca-4fe3-9150-fbab143def43"
    >
      <div class="sourceCode" id="cb22">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>data.plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;BTC Price&quot;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Price of Bitcoin from 1 Oct 2013 to 18 May 2021&quot;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">14</span>)<span class="op">;</span></span></code></pre>
      </div>
      <div class="output display_data">
        <p>
          <img
            src="vertopal_69d537c10f7446b58861e707add3c6df/ab750574ad2dec9947c6ae59f6be592417290dda.png"
          />
        </p>
      </div>
    </div>
    <section id="data-pre-processing" class="cell markdown" id="0e__JlQPMGRW">
      <h2>Data Pre Processing</h2>
    </section>
    <div class="cell code" data-execution_count="14" id="-qPe3dQ1MGC_">
      <div class="sourceCode" id="cb23">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>HORIZON <span class="op">=</span> <span class="dv">1</span> <span class="co"># predict 1 step at a time</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>WINDOW_SIZE <span class="op">=</span> <span class="dv">50</span> <span class="co"># use a week worth of timesteps to predict the horizon</span></span></code></pre>
      </div>
    </div>
    <section id="split-data" class="cell markdown" id="ZFZmzPgRVUYB">
      <h3>Split Data</h3>
    </section>
    <div class="cell code" data-execution_count="15" id="Ch8o4QALNmPn">
      <div class="sourceCode" id="cb24">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create function to label windowed data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_labelled_windows(x, horizon<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Creates labels for windowed dataset.</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">  E.g. if horizon=1 (default)</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Input: [1, 2, 3, 4, 5, 6] -&gt; Output: ([1, 2, 3, 4, 5], [6])</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">  &quot;&quot;&quot;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x[:, :<span class="op">-</span>horizon], x[:, <span class="op">-</span>horizon:]</span></code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="16"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="8QgUvDDKNqUR"
      data-outputId="90d86126-de31-4ac4-f8d9-85b9373a0a41"
    >
      <div class="sourceCode" id="cb25">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test out the window labelling function</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>test_windows, test_labels <span class="op">=</span> get_labelled_windows(tf.expand_dims(tf.<span class="bu">range</span>(<span class="dv">8</span>)<span class="op">+</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">0</span>), horizon<span class="op">=</span>HORIZON)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Window: </span><span class="sc">{</span>tf<span class="sc">.</span>squeeze(test_window)<span class="sc">.</span>numpy()<span class="sc">}</span><span class="ss"> -&gt; Label: </span><span class="sc">{</span>tf<span class="sc">.</span>squeeze(test_label)<span class="sc">.</span>numpy()<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>Window: [1 2 3 4 5 6 7] -&gt; Label: 8
</code></pre>
      </div>
    </div>
    <div class="cell code" data-execution_count="17" id="aUO79JMEN2rr">
      <div class="sourceCode" id="cb27">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create function to view NumPy arrays as windows</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_windows(x, window_size<span class="op">=</span><span class="dv">7</span>, horizon<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Turns a 1D array into a 2D array of sequential windows of window_size.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">  &quot;&quot;&quot;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Create a window of specific window_size (add the horizon on the end for later labelling)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  window_step <span class="op">=</span> np.expand_dims(np.arange(window_size<span class="op">+</span>horizon), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(f&quot;Window step:\n {window_step}&quot;)</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Create a 2D array of multiple window steps (minus 1 to account for 0 indexing)</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  window_indexes <span class="op">=</span> window_step <span class="op">+</span> np.expand_dims(np.arange(<span class="bu">len</span>(x)<span class="op">-</span>(window_size<span class="op">+</span>horizon<span class="op">-</span><span class="dv">1</span>)), axis<span class="op">=</span><span class="dv">0</span>).T <span class="co"># create 2D array of windows of size window_size</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(f&quot;Window indexes:\n {window_indexes[:3], window_indexes[-3:], window_indexes.shape}&quot;)</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Index on the target array (time series) with 2D array of multiple window steps</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  windowed_array <span class="op">=</span> x[window_indexes]</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Get the labelled windows</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  windows, labels <span class="op">=</span> get_labelled_windows(windowed_array, horizon<span class="op">=</span>horizon)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> windows, labels</span></code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="18"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="ph51u98SN4sx"
      data-outputId="cec62796-385d-43da-ad02-d91740c36532"
    >
      <div class="sourceCode" id="cb28">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>full_windows, full_labels <span class="op">=</span> make_windows(data.values, window_size<span class="op">=</span><span class="dv">50</span>, horizon<span class="op">=</span>HORIZON)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(full_windows), <span class="bu">len</span>(full_labels)</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="18">
        <pre><code>(3326, 3326)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="19"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="wphyxsB5N4nh"
      data-outputId="6db47480-9c69-4f42-eb6d-8ac51c8263e4"
    >
      <div class="sourceCode" id="cb30">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(full_windows[<span class="dv">0</span>])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(full_labels[<span class="dv">0</span>])</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(full_windows[<span class="dv">1</span>])</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>[4.4825     4.80666667 5.         5.2525     5.22333333 6.28619048
 6.445      6.8        6.95       6.58166667 6.603      7.121875
 7.0625     6.9603125  6.41       7.15       6.71428571 6.14166667
 6.24472222 6.22571429 6.835      6.386      6.485      6.4075
 6.49555556 6.28194444 6.185      5.65142857 4.91       5.696
 5.545      5.61902439 5.78875    6.17087719 6.20481481 6.095625
 5.83916667 5.52625    5.672      5.74333333 5.78357143 5.87692308
 5.605      5.6375     5.64818182 5.1930303  4.94526316 4.57558824
 4.6909375  4.39769231]
[4.33166667]
[4.80666667 5.         5.2525     5.22333333 6.28619048 6.445
 6.8        6.95       6.58166667 6.603      7.121875   7.0625
 6.9603125  6.41       7.15       6.71428571 6.14166667 6.24472222
 6.22571429 6.835      6.386      6.485      6.4075     6.49555556
 6.28194444 6.185      5.65142857 4.91       5.696      5.545
 5.61902439 5.78875    6.17087719 6.20481481 6.095625   5.83916667
 5.52625    5.672      5.74333333 5.78357143 5.87692308 5.605
 5.6375     5.64818182 5.1930303  4.94526316 4.57558824 4.6909375
 4.39769231 4.33166667]
</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="20"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="42JceYuTPdH9"
      data-outputId="aa7c8d86-7067-4d91-dd24-65140ebf755c"
    >
      <div class="sourceCode" id="cb32">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first 3 windows/labels</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f&quot;Window: </span><span class="sc">{</span>full_windows[i]<span class="sc">}</span><span class="ss"> -&gt; Label: </span><span class="sc">{</span>full_labels[i]<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>Window: [4.4825     4.80666667 5.         5.2525     5.22333333 6.28619048
 6.445      6.8        6.95       6.58166667 6.603      7.121875
 7.0625     6.9603125  6.41       7.15       6.71428571 6.14166667
 6.24472222 6.22571429 6.835      6.386      6.485      6.4075
 6.49555556 6.28194444 6.185      5.65142857 4.91       5.696
 5.545      5.61902439 5.78875    6.17087719 6.20481481 6.095625
 5.83916667 5.52625    5.672      5.74333333 5.78357143 5.87692308
 5.605      5.6375     5.64818182 5.1930303  4.94526316 4.57558824
 4.6909375  4.39769231] -&gt; Label: [4.33166667]
Window: [4.80666667 5.         5.2525     5.22333333 6.28619048 6.445
 6.8        6.95       6.58166667 6.603      7.121875   7.0625
 6.9603125  6.41       7.15       6.71428571 6.14166667 6.24472222
 6.22571429 6.835      6.386      6.485      6.4075     6.49555556
 6.28194444 6.185      5.65142857 4.91       5.696      5.545
 5.61902439 5.78875    6.17087719 6.20481481 6.095625   5.83916667
 5.52625    5.672      5.74333333 5.78357143 5.87692308 5.605
 5.6375     5.64818182 5.1930303  4.94526316 4.57558824 4.6909375
 4.39769231 4.33166667] -&gt; Label: [4.56071429]
Window: [5.         5.2525     5.22333333 6.28619048 6.445      6.8
 6.95       6.58166667 6.603      7.121875   7.0625     6.9603125
 6.41       7.15       6.71428571 6.14166667 6.24472222 6.22571429
 6.835      6.386      6.485      6.4075     6.49555556 6.28194444
 6.185      5.65142857 4.91       5.696      5.545      5.61902439
 5.78875    6.17087719 6.20481481 6.095625   5.83916667 5.52625
 5.672      5.74333333 5.78357143 5.87692308 5.605      5.6375
 5.64818182 5.1930303  4.94526316 4.57558824 4.6909375  4.39769231
 4.33166667 4.56071429] -&gt; Label: [4.4834375]
</code></pre>
      </div>
    </div>
    <div class="cell code" data-execution_count="21" id="zydUyTuNPr1q">
      <div class="sourceCode" id="cb34">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the train/test splits</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_train_test_splits(windows, labels, test_split<span class="op">=</span><span class="fl">0.2</span>):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Splits matching pairs of windows and labels into train and test splits.</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">  &quot;&quot;&quot;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  split_size <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(windows) <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>test_split)) <span class="co"># this will default to 80% train/20% test</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  train_windows <span class="op">=</span> windows[:split_size]</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  train_labels <span class="op">=</span> labels[:split_size]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  test_windows <span class="op">=</span> windows[split_size:]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  test_labels <span class="op">=</span> labels[split_size:]</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> train_windows, test_windows, train_labels, test_labels</span></code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="22"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="RsyzqZ2ZPtwb"
      data-outputId="6225b5c8-8406-481c-9f00-af428eeb3475"
    >
      <div class="sourceCode" id="cb35">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>train_windows, test_windows, train_labels, test_labels <span class="op">=</span> make_train_test_splits(full_windows, full_labels, test_split<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(train_windows), <span class="bu">len</span>(test_windows), <span class="bu">len</span>(train_labels), <span class="bu">len</span>(test_labels)</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="22">
        <pre><code>(2660, 666, 2660, 666)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="23"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="k0McsSv8SDtx"
      data-outputId="250c9443-ab89-4404-b29f-8775f8604228"
    >
      <div class="sourceCode" id="cb37">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>train_windows[:<span class="dv">5</span>,<span class="op">-</span><span class="dv">5</span>:], train_labels[:<span class="dv">5</span>]</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="23">
        <pre><code>(array([[5.1930303 , 4.94526316, 4.57558824, 4.6909375 , 4.39769231],
        [4.94526316, 4.57558824, 4.6909375 , 4.39769231, 4.33166667],
        [4.57558824, 4.6909375 , 4.39769231, 4.33166667, 4.56071429],
        [4.6909375 , 4.39769231, 4.33166667, 4.56071429, 4.4834375 ],
        [4.39769231, 4.33166667, 4.56071429, 4.4834375 , 4.54222222]]),
 array([[4.33166667],
        [4.56071429],
        [4.4834375 ],
        [4.54222222],
        [4.89095238]]))</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="24"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="W1vUQgxDSHUj"
      data-outputId="5c013526-949c-4a1c-e41c-fefd610ea09f"
    >
      <div class="sourceCode" id="cb39">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check to see if same</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>np.array_equal((train_windows[<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>:]), train_labels[<span class="dv">0</span>])</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="24">
        <pre><code>True</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="25"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="mbijISrzSyY3"
      data-outputId="2d2eeff5-cad2-4206-e952-65fbf0f9f4d7"
    >
      <div class="sourceCode" id="cb41">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_windows[<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>:])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_labels[<span class="dv">0</span>])</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>[4.33166667]
[4.33166667]
</code></pre>
      </div>
    </div>
    <section id="modelling" class="cell markdown" id="G0J3NC6XVMKJ">
      <h2>Modelling</h2>
    </section>
    <section
      id="make-a-modelling-checkpoint"
      class="cell markdown"
      id="8OsIrjOKU5aN"
    >
      <h3>Make a modelling checkpoint</h3>
    </section>
    <div class="cell code" data-execution_count="26" id="p2uESVz6U52W">
      <div class="sourceCode" id="cb43">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to implement a ModelCheckpoint callback with a specific filename</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_model_checkpoint(model_name, save_path<span class="op">=</span><span class="st">&quot;model_experiments&quot;</span>):</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tf.keras.callbacks.ModelCheckpoint(filepath<span class="op">=</span>os.path.join(save_path, model_name), <span class="co"># create filepath to save model</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                                            verbose<span class="op">=</span><span class="dv">0</span>, <span class="co"># only output a limited amount of text</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                                            save_best_only<span class="op">=</span><span class="va">True</span>) <span class="co"># save only the best model to file</span></span></code></pre>
      </div>
    </div>
    <section id="model-1-rnn" class="cell markdown" id="p0ar6xliVb-P">
      <h3>Model 1: RNN</h3>
    </section>
    <div
      class="cell code"
      data-execution_count="85"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="Ngb00NqZWY4m"
      data-outputId="48437afd-a0c0-45ab-d0b5-262749d15a2c"
    >
      <div class="sourceCode" id="cb44">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Model</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, SimpleRNN, Dropout, Flatten, Input</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (train_windows.shape[<span class="dv">1</span>], <span class="dv">1</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Input layer</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> Input(shape<span class="op">=</span>input_shape)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># First RNN layer</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> SimpleRNN(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, return_sequences<span class="op">=</span><span class="va">True</span>)(inputs)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Dropout(<span class="fl">0.25</span>)(x)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Second RNN layer</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> SimpleRNN(<span class="dv">256</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, return_sequences<span class="op">=</span><span class="va">True</span>)(x)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Dropout(<span class="fl">0.25</span>)(x)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Third RNN layer</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> SimpleRNN(<span class="dv">512</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, return_sequences<span class="op">=</span><span class="va">True</span>)(x)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Dropout(<span class="fl">0.35</span>)(x)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourth RNN layer</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> SimpleRNN(<span class="dv">256</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, return_sequences<span class="op">=</span><span class="va">True</span>)(x)</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Dropout(<span class="fl">0.25</span>)(x)</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fifth RNN layer</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> SimpleRNN(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>, return_sequences<span class="op">=</span><span class="va">True</span>)(x)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Dropout(<span class="fl">0.25</span>)(x)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the matrix to 1-line</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Flatten()(x)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Output layer</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> Dense(<span class="dv">1</span>)(x)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>model_1 <span class="op">=</span> Model(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>outputs)</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>model_1.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&quot;adam&quot;</span>, loss<span class="op">=</span><span class="st">&quot;mean_squared_error&quot;</span>)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>model_1.fit(train_windows, train_labels, epochs<span class="op">=</span><span class="dv">25</span>, batch_size<span class="op">=</span><span class="dv">64</span>,</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>            validation_data<span class="op">=</span>(test_windows, test_labels),</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>            callbacks<span class="op">=</span>[create_model_checkpoint(model_name<span class="op">=</span>model_1.name)])</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>Epoch 1/25
42/42 [==============================] - 24s 419ms/step - loss: 4410816.0000 - val_loss: 84577920.0000
Epoch 2/25
42/42 [==============================] - 17s 410ms/step - loss: 903259.4375 - val_loss: 39255444.0000
Epoch 3/25
42/42 [==============================] - 25s 602ms/step - loss: 529130.6875 - val_loss: 30258398.0000
Epoch 4/25
42/42 [==============================] - 16s 391ms/step - loss: 533007.1875 - val_loss: 41410592.0000
Epoch 5/25
42/42 [==============================] - 12s 292ms/step - loss: 360780.9375 - val_loss: 54421484.0000
Epoch 6/25
42/42 [==============================] - 18s 428ms/step - loss: 368699.0625 - val_loss: 23681718.0000
Epoch 7/25
42/42 [==============================] - 10s 242ms/step - loss: 455356.7812 - val_loss: 40735252.0000
Epoch 8/25
42/42 [==============================] - 16s 395ms/step - loss: 453056.3750 - val_loss: 20106646.0000
Epoch 9/25
42/42 [==============================] - 10s 246ms/step - loss: 393486.8125 - val_loss: 26333694.0000
Epoch 10/25
42/42 [==============================] - 11s 253ms/step - loss: 343802.2188 - val_loss: 44066140.0000
Epoch 11/25
42/42 [==============================] - 9s 222ms/step - loss: 277450.3438 - val_loss: 23385876.0000
Epoch 12/25
42/42 [==============================] - 10s 249ms/step - loss: 277976.2188 - val_loss: 29296304.0000
Epoch 13/25
42/42 [==============================] - 17s 406ms/step - loss: 408467.4062 - val_loss: 19803716.0000
Epoch 14/25
42/42 [==============================] - 9s 224ms/step - loss: 247113.4531 - val_loss: 39757164.0000
Epoch 15/25
42/42 [==============================] - 11s 253ms/step - loss: 313072.5625 - val_loss: 23532774.0000
Epoch 16/25
42/42 [==============================] - 10s 251ms/step - loss: 241822.2500 - val_loss: 63608432.0000
Epoch 17/25
42/42 [==============================] - 10s 243ms/step - loss: 242060.5156 - val_loss: 50459028.0000
Epoch 18/25
42/42 [==============================] - 10s 242ms/step - loss: 220923.0469 - val_loss: 34607988.0000
Epoch 19/25
42/42 [==============================] - 9s 221ms/step - loss: 219316.0469 - val_loss: 38128008.0000
Epoch 20/25
42/42 [==============================] - 11s 263ms/step - loss: 213926.1875 - val_loss: 42190232.0000
Epoch 21/25
42/42 [==============================] - 10s 243ms/step - loss: 219507.3750 - val_loss: 25578060.0000
Epoch 22/25
42/42 [==============================] - 10s 245ms/step - loss: 205667.1094 - val_loss: 40058492.0000
Epoch 23/25
42/42 [==============================] - 11s 254ms/step - loss: 197143.0781 - val_loss: 37776528.0000
Epoch 24/25
42/42 [==============================] - 10s 248ms/step - loss: 246907.7656 - val_loss: 39071584.0000
Epoch 25/25
42/42 [==============================] - 10s 238ms/step - loss: 248541.3750 - val_loss: 49349240.0000
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="85">
        <pre><code>&lt;keras.callbacks.History at 0x7f09eb481f60&gt;</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="86"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="Gfjftd39Yu7z"
      data-outputId="3dea81ef-61f3-4966-e76b-18bce0bc55d5"
    >
      <div class="sourceCode" id="cb47">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model on test data</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>model_1.evaluate(test_windows, test_labels)</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>21/21 [==============================] - 0s 22ms/step - loss: 49349240.0000
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="86">
        <pre><code>49349240.0</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="100"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="JDz7P1UTY66T"
      data-outputId="abbde934-d8b7-4ed9-cc21-f887ef19a4da"
    >
      <div class="sourceCode" id="cb50">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in saved best performing model_1 and evaluate on test data</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>model_1 <span class="op">=</span> tf.keras.models.load_model(<span class="st">&quot;/content/model_experiments/model_1&quot;</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>model_1.evaluate(test_windows, test_labels)</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>21/21 [==============================] - 1s 21ms/step - loss: 19803714.0000
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="100">
        <pre><code>19803714.0</code></pre>
      </div>
    </div>
    <div class="cell code" data-execution_count="101" id="Pe7aeRb6ZOKk">
      <div class="sourceCode" id="cb53">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_preds(model, input_data):</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">  Uses model to make predictions on input_data.</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">  Parameters</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">  ----------</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">  model: trained model</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">  input_data: windowed input data (same kind of data model was trained on)</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns model predictions on input_data.</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">  &quot;&quot;&quot;</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  forecast <span class="op">=</span> model.predict(input_data)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tf.squeeze(forecast) <span class="co"># return 1D array of predictions</span></span></code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="102"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="yr4e70mqZMPr"
      data-outputId="8ab09207-afe0-4b62-9e1b-0e2547822095"
    >
      <div class="sourceCode" id="cb54">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions using model_1 on the test dataset and view the results</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>model_1_preds <span class="op">=</span> make_preds(model_1, test_windows)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(model_1_preds), model_1_preds[:<span class="dv">10</span>]</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>21/21 [==============================] - 1s 22ms/step
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="102">
        <pre><code>(666,
 &lt;tf.Tensor: shape=(10,), dtype=float32, numpy=
 array([6771.8887, 6641.4834, 6538.2534, 6507.7266, 6498.7197, 6469.3926,
        6438.3027, 6447.1714, 6473.344 , 6500.9575], dtype=float32)&gt;)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="103"
      data-colab='{"base_uri":"https://localhost:8080/","height":311}'
      id="ebT2sFkPZQIV"
      data-outputId="33b1077e-51ac-4aaa-b2be-e185b73efca6"
    >
      <div class="sourceCode" id="cb57">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">80</span>, facecolor<span class="op">=</span><span class="st">&#39;w&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;k&#39;</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plt.plot(test_labels,color<span class="op">=</span><span class="st">&quot;r&quot;</span>,label<span class="op">=</span><span class="st">&quot;true result&quot;</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>plt.plot(model_1_preds,color<span class="op">=</span><span class="st">&quot;b&quot;</span>,label<span class="op">=</span><span class="st">&quot;predicted result&quot;</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Time(50 days)&quot;</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Close Values&quot;</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p>
          <img
            src="vertopal_69d537c10f7446b58861e707add3c6df/5f7cf21634ee0d32f8c259178405208e528fab0a.png"
          />
        </p>
      </div>
    </div>
    <div class="cell code" data-execution_count="104" id="NNkG7uxpa49L">
      <div class="sourceCode" id="cb58">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MASE implemented courtesy of sktime - https://github.com/alan-turing-institute/sktime/blob/ee7a06843a44f4aaec7582d847e36073a9ab0566/sktime/performance_metrics/forecasting/_functions.py#L16</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_absolute_scaled_error(y_true, y_pred):</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Implement MASE (assuming no seasonality of data).</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">  &quot;&quot;&quot;</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  mae <span class="op">=</span> tf.reduce_mean(tf.<span class="bu">abs</span>(y_true <span class="op">-</span> y_pred))</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find MAE of naive forecast (no seasonality)</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  mae_naive_no_season <span class="op">=</span> tf.reduce_mean(tf.<span class="bu">abs</span>(y_true[<span class="dv">1</span>:] <span class="op">-</span> y_true[:<span class="op">-</span><span class="dv">1</span>])) <span class="co"># our seasonality is 1 day (hence the shifting of 1 day)</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mae <span class="op">/</span> mae_naive_no_season</span></code></pre>
      </div>
    </div>
    <div class="cell code" data-execution_count="105" id="vVyjDwP6a1ZC">
      <div class="sourceCode" id="cb59">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_preds(y_true, y_pred):</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make sure float32 (for metric calculations)</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  y_true <span class="op">=</span> tf.cast(y_true, dtype<span class="op">=</span>tf.float32)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> tf.cast(y_pred, dtype<span class="op">=</span>tf.float32)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate various metrics</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  mae <span class="op">=</span> tf.keras.metrics.mean_absolute_error(y_true, y_pred)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  mse <span class="op">=</span> tf.keras.metrics.mean_squared_error(y_true, y_pred)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  rmse <span class="op">=</span> tf.sqrt(mse)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  mape <span class="op">=</span> tf.keras.metrics.mean_absolute_percentage_error(y_true, y_pred)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  mase <span class="op">=</span> mean_absolute_scaled_error(y_true, y_pred)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Account for different sized metrics (for longer horizons, reduce to single number)</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> mae.ndim <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># if mae isn&#39;t already a scalar, reduce it to one by aggregating tensors to mean</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> tf.reduce_mean(mae)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    mse <span class="op">=</span> tf.reduce_mean(mse)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> tf.reduce_mean(rmse)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    mape <span class="op">=</span> tf.reduce_mean(mape)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    mase <span class="op">=</span> tf.reduce_mean(mase)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {<span class="st">&quot;mae&quot;</span>: mae.numpy(),</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;mse&quot;</span>: mse.numpy(),</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;rmse&quot;</span>: rmse.numpy(),</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;mape&quot;</span>: mape.numpy(),</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;mase&quot;</span>: mase.numpy()}</span></code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="106"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="_u3Jy2zGa9Ge"
      data-outputId="fa080092-8ccf-4ce8-87f3-0fe401ec758d"
    >
      <div class="sourceCode" id="cb60">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate preds</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>model_1_results <span class="op">=</span> evaluate_preds(y_true<span class="op">=</span>tf.squeeze(test_labels), <span class="co"># reduce to right shape</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                                 y_pred<span class="op">=</span>model_1_preds)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>model_1_results</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="106">
        <pre><code>{&#39;mae&#39;: 3170.4219,
 &#39;mse&#39;: 19803716.0,
 &#39;rmse&#39;: 4450.1367,
 &#39;mape&#39;: 20.01894,
 &#39;mase&#39;: 8.433455}</code></pre>
      </div>
    </div>
    <section id="model-2-lstm" class="cell markdown" id="bPsd4S4DbJn8">
      <h3>Model 2: LSTM</h3>
    </section>
    <div
      class="cell code"
      data-execution_count="74"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="Nd9q26FnbJVm"
      data-outputId="6a1b8c42-90c5-45ca-f971-a4e88e75338a"
    >
      <div class="sourceCode" id="cb62">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s build an LSTM model with the Functional API</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>inputs <span class="op">=</span> layers.Input(shape<span class="op">=</span>(WINDOW_SIZE))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.Lambda(<span class="kw">lambda</span> x: tf.expand_dims(x, axis<span class="op">=</span><span class="dv">1</span>))(inputs) <span class="co"># expand input dimension to be compatible with LSTM</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(x.shape)</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># x = layers.LSTM(128, activation=&quot;relu&quot;, return_sequences=True)(x) # this layer will error if the inputs are not the right shape</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> layers.LSTM(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>)(x) <span class="co"># using the tanh loss function results in a massive error</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(x.shape)</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add another optional dense layer (you could add more of these to see if they improve model performance)</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># x = layers.Dense(32, activation=&quot;relu&quot;)(x)</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> layers.Dense(HORIZON)(x)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> tf.keras.Model(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>output, name<span class="op">=</span><span class="st">&quot;model_2&quot;</span>)</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>model_2.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">&quot;mean_squared_error&quot;</span>,optimizer<span class="op">=</span><span class="st">&quot;adam&quot;</span>)</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>model_2.fit(train_windows,</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>            train_labels,</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>            epochs<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>            batch_size<span class="op">=</span><span class="dv">64</span>,</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>            validation_data<span class="op">=</span>(test_windows, test_labels),</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>            callbacks<span class="op">=</span>[create_model_checkpoint(model_name<span class="op">=</span><span class="st">&quot;model_2&quot;</span>)])</span></code></pre>
      </div>
      <div class="output stream stderr">
        <pre><code>WARNING:tensorflow:Layer lstm_2 will not use cuDNN kernels since it doesn&#39;t meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
</code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>Epoch 1/25
42/42 [==============================] - 4s 50ms/step - loss: 1808624.6250 - val_loss: 6503321.0000
Epoch 2/25
42/42 [==============================] - 0s 6ms/step - loss: 424576.1875 - val_loss: 6984816.0000
Epoch 3/25
42/42 [==============================] - 2s 60ms/step - loss: 280961.3125 - val_loss: 3647051.7500
Epoch 4/25
42/42 [==============================] - 2s 45ms/step - loss: 219967.9062 - val_loss: 3438968.2500
Epoch 5/25
42/42 [==============================] - 2s 45ms/step - loss: 197686.6250 - val_loss: 2750325.2500
Epoch 6/25
42/42 [==============================] - 2s 53ms/step - loss: 196534.1406 - val_loss: 2527586.5000
Epoch 7/25
42/42 [==============================] - 0s 11ms/step - loss: 163256.2656 - val_loss: 2604448.5000
Epoch 8/25
42/42 [==============================] - 0s 11ms/step - loss: 157993.5469 - val_loss: 3300821.2500
Epoch 9/25
42/42 [==============================] - 2s 49ms/step - loss: 136287.0625 - val_loss: 2448473.2500
Epoch 10/25
42/42 [==============================] - 0s 6ms/step - loss: 128121.6875 - val_loss: 2627869.5000
Epoch 11/25
42/42 [==============================] - 0s 6ms/step - loss: 129144.7344 - val_loss: 3614092.0000
Epoch 12/25
42/42 [==============================] - 2s 45ms/step - loss: 134021.0469 - val_loss: 2033770.6250
Epoch 13/25
42/42 [==============================] - 2s 61ms/step - loss: 111094.2109 - val_loss: 1968591.0000
Epoch 14/25
42/42 [==============================] - 0s 6ms/step - loss: 114471.1562 - val_loss: 2616687.7500
Epoch 15/25
42/42 [==============================] - 2s 46ms/step - loss: 129244.8516 - val_loss: 1808181.3750
Epoch 16/25
42/42 [==============================] - 0s 6ms/step - loss: 111141.5469 - val_loss: 1842240.0000
Epoch 17/25
42/42 [==============================] - 0s 6ms/step - loss: 102520.2422 - val_loss: 4557958.5000
Epoch 18/25
42/42 [==============================] - 0s 6ms/step - loss: 107181.9688 - val_loss: 2226043.0000
Epoch 19/25
42/42 [==============================] - 0s 6ms/step - loss: 90346.1875 - val_loss: 1875398.0000
Epoch 20/25
42/42 [==============================] - 0s 6ms/step - loss: 86874.1172 - val_loss: 2621749.5000
Epoch 21/25
42/42 [==============================] - 3s 63ms/step - loss: 99320.1250 - val_loss: 1464885.6250
Epoch 22/25
42/42 [==============================] - 0s 6ms/step - loss: 84486.8594 - val_loss: 2314442.5000
Epoch 23/25
42/42 [==============================] - 0s 6ms/step - loss: 79896.9844 - val_loss: 2060027.0000
Epoch 24/25
42/42 [==============================] - 0s 6ms/step - loss: 80311.3359 - val_loss: 1756465.3750
Epoch 25/25
42/42 [==============================] - 0s 6ms/step - loss: 100852.2734 - val_loss: 1474528.0000
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="74">
        <pre><code>&lt;keras.callbacks.History at 0x7f09ea816c20&gt;</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="75"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="GWEqoXD0cjtA"
      data-outputId="fed2ff75-da36-4389-bef0-660fd564478b"
    >
      <div class="sourceCode" id="cb66">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model on test data</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>model_2.evaluate(test_windows, test_labels)</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>21/21 [==============================] - 0s 2ms/step - loss: 1474528.2500
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="75">
        <pre><code>1474528.25</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="78"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="6wj-KWbAcjtH"
      data-outputId="63cccd5c-d110-41d8-cd96-235211fe2713"
    >
      <div class="sourceCode" id="cb69">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in saved best performing model_1 and evaluate on test data</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> tf.keras.models.load_model(<span class="st">&quot;model_experiments/model_2&quot;</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>model_2.evaluate(test_windows, test_labels)</span></code></pre>
      </div>
      <div class="output stream stderr">
        <pre><code>WARNING:tensorflow:Layer lstm_2 will not use cuDNN kernels since it doesn&#39;t meet the criteria. It will use a generic GPU kernel as fallback when running on GPU.
</code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>21/21 [==============================] - 0s 2ms/step - loss: 1464885.0000
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="78">
        <pre><code>1464885.0</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="79"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="vqh3IptTcjtH"
      data-outputId="b4228122-8cd7-4c6a-b8d5-9584f210c680"
    >
      <div class="sourceCode" id="cb73">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions using model_1 on the test dataset and view the results</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>model_2_preds <span class="op">=</span> make_preds(model_2, test_windows)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(model_2_preds), model_2_preds[:<span class="dv">10</span>]</span></code></pre>
      </div>
      <div class="output stream stdout">
        <pre><code>21/21 [==============================] - 0s 2ms/step
</code></pre>
      </div>
      <div class="output execute_result" data-execution_count="79">
        <pre><code>(666,
 &lt;tf.Tensor: shape=(10,), dtype=float32, numpy=
 array([8358.424 , 8242.882 , 8022.0947, 7916.5244, 7871.824 , 7816.0513,
        7815.2964, 7715.8223, 7612.336 , 7790.053 ], dtype=float32)&gt;)</code></pre>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="80"
      data-colab='{"base_uri":"https://localhost:8080/","height":311}'
      id="Il9UzT2ZcjtH"
      data-outputId="539b9999-eb07-4e4c-8173-3924a2fad70d"
    >
      <div class="sourceCode" id="cb76">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>), dpi<span class="op">=</span><span class="dv">80</span>, facecolor<span class="op">=</span><span class="st">&#39;w&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;k&#39;</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>plt.plot(test_labels,color<span class="op">=</span><span class="st">&quot;r&quot;</span>,label<span class="op">=</span><span class="st">&quot;true result&quot;</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>plt.plot(model_2_preds,color<span class="op">=</span><span class="st">&quot;b&quot;</span>,label<span class="op">=</span><span class="st">&quot;predicted result&quot;</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Time(50 days)&quot;</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Close Values&quot;</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p>
          <img
            src="vertopal_69d537c10f7446b58861e707add3c6df/ab3f5677da32bad53a06c6faa1e0f22b8bf00179.png"
          />
        </p>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="81"
      data-colab='{"base_uri":"https://localhost:8080/"}'
      id="dnqvEd00cjtI"
      data-outputId="60f748c9-cc53-423f-eb70-0ed6cc980606"
    >
      <div class="sourceCode" id="cb77">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate preds</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>model_2_results <span class="op">=</span> evaluate_preds(y_true<span class="op">=</span>tf.squeeze(test_labels), <span class="co"># reduce to right shape</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                                 y_pred<span class="op">=</span>model_2_preds)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>model_2_results</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="81">
        <pre><code>{&#39;mae&#39;: 660.5167,
 &#39;mse&#39;: 1464885.1,
 &#39;rmse&#39;: 1210.3243,
 &#39;mape&#39;: 3.9793246,
 &#39;mase&#39;: 1.7570024}</code></pre>
      </div>
    </div>
    <section id="compare-models" class="cell markdown" id="zjoG5tFEgkdC">
      <h2>Compare Models</h2>
    </section>
    <div
      class="cell code"
      data-execution_count="115"
      data-colab='{"base_uri":"https://localhost:8080/","height":607}'
      id="z27ts9mPiY_Y"
      data-outputId="194b1f04-3272-47a2-9da1-06ed1fc56bae"
    >
      <div class="sourceCode" id="cb79">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Membuat figure dan axes</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot pertama</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>ax1.plot(test_labels, color<span class="op">=</span><span class="st">&quot;r&quot;</span>, label<span class="op">=</span><span class="st">&quot;true result&quot;</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>ax1.plot(model_1_preds, color<span class="op">=</span><span class="st">&quot;b&quot;</span>, label<span class="op">=</span><span class="st">&quot;predicted result&quot;</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">&quot;Time (50 days)&quot;</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">&quot;Close Values&quot;</span>)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&quot;Model 1 RNN&quot;</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>ax1.grid(<span class="va">True</span>)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot kedua</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(test_labels, color<span class="op">=</span><span class="st">&quot;r&quot;</span>, label<span class="op">=</span><span class="st">&quot;true result&quot;</span>)</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(model_2_preds, color<span class="op">=</span><span class="st">&quot;b&quot;</span>, label<span class="op">=</span><span class="st">&quot;predicted result&quot;</span>)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">&quot;Time (50 days)&quot;</span>)</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">&quot;Close Values&quot;</span>)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&quot;Model 2 LSTM&quot;</span>)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>ax2.grid(<span class="va">True</span>)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Menampilkan plot</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre>
      </div>
      <div class="output display_data">
        <p>
          <img
            src="vertopal_69d537c10f7446b58861e707add3c6df/c8047656cf0a7f30d6e3fc7e40c9e3b18245cebc.png"
          />
        </p>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="137"
      data-colab='{"base_uri":"https://localhost:8080/","height":112}'
      id="fnWiXRqhgkvr"
      data-outputId="845b1451-2122-45ee-fcf5-d501a18ed2be"
    >
      <div class="sourceCode" id="cb80">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare different model results (w = window, h = horizon, e.g. w=7 means a window size of 7)</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>model_results <span class="op">=</span> pd.DataFrame({<span class="st">&quot;model 1 (RNN)&quot;</span>: model_1_results,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;model 2 (LSTM)&quot;</span>: model_2_results}).T</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>model_results.head(<span class="dv">10</span>)</span></code></pre>
      </div>
      <div class="output execute_result" data-execution_count="137">
        <div id="df-d5c002db-1f51-443d-ae68-8290ae17c239">
          <div class="colab-df-container">
            <div>
              <style scoped>
                .dataframe tbody tr th:only-of-type {
                  vertical-align: middle;
                }

                .dataframe tbody tr th {
                  vertical-align: top;
                }

                .dataframe thead th {
                  text-align: right;
                }
              </style>
              <table border="1" class="dataframe">
                <thead>
                  <tr style="text-align: right">
                    <th></th>
                    <th>mae</th>
                    <th>mse</th>
                    <th>rmse</th>
                    <th>mape</th>
                    <th>mase</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>model 1 (RNN)</th>
                    <td>3170.4219</td>
                    <td>19803716.0</td>
                    <td>4450.1367</td>
                    <td>20.018940</td>
                    <td>8.433455</td>
                  </tr>
                  <tr>
                    <th>model 2 (LSTM)</th>
                    <td>660.5167</td>
                    <td>1464885.1</td>
                    <td>1210.3243</td>
                    <td>3.979325</td>
                    <td>1.757002</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button
              class="colab-df-convert"
              onclick="convertToInteractive('df-d5c002db-1f51-443d-ae68-8290ae17c239')"
              title="Convert this dataframe to an interactive table."
              style="display: none"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 0 24 24"
                width="24px"
              >
                <path d="M0 0h24v24H0V0z" fill="none" />
                <path
                  d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"
                />
                <path
                  d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"
                />
              </svg>
            </button>

            <style>
              .colab-df-container {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
              }

              .colab-df-convert {
                background-color: #e8f0fe;
                border: none;
                border-radius: 50%;
                cursor: pointer;
                display: none;
                fill: #1967d2;
                height: 32px;
                padding: 0 0 0 0;
                width: 32px;
              }

              .colab-df-convert:hover {
                background-color: #e2ebfa;
                box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3),
                  0px 1px 3px 1px rgba(60, 64, 67, 0.15);
                fill: #174ea6;
              }

              [theme="dark"] .colab-df-convert {
                background-color: #3b4455;
                fill: #d2e3fc;
              }

              [theme="dark"] .colab-df-convert:hover {
                background-color: #434b5c;
                box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
                filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
                fill: #ffffff;
              }
            </style>

            <script>
              const buttonEl = document.querySelector(
                "#df-d5c002db-1f51-443d-ae68-8290ae17c239 button.colab-df-convert"
              );
              buttonEl.style.display = google.colab.kernel.accessAllowed
                ? "block"
                : "none";

              async function convertToInteractive(key) {
                const element = document.querySelector(
                  "#df-d5c002db-1f51-443d-ae68-8290ae17c239"
                );
                const dataTable = await google.colab.kernel.invokeFunction(
                  "convertToInteractive",
                  [key],
                  {}
                );
                if (!dataTable) return;

                const docLinkHtml =
                  "Like what you see? Visit the " +
                  '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>' +
                  " to learn more about interactive tables.";
                element.innerHTML = "";
                dataTable["output_type"] = "display_data";
                await google.colab.output.renderOutput(dataTable, element);
                const docLink = document.createElement("div");
                docLink.innerHTML = docLinkHtml;
                element.appendChild(docLink);
              }
            </script>
          </div>
        </div>
      </div>
    </div>
    <div
      class="cell code"
      data-execution_count="138"
      data-colab='{"base_uri":"https://localhost:8080/","height":694}'
      id="awkxY9OWlKPb"
      data-outputId="6e6a5c33-3a3d-4b25-a19e-676d3d63d6ee"
    >
      <div class="sourceCode" id="cb81">
        <pre
          class="sourceCode python"
        ><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort model results by MAE and plot them</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>model_results[[<span class="st">&quot;mae&quot;</span>]].sort_values(by<span class="op">=</span><span class="st">&quot;mae&quot;</span>).plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>), kind<span class="op">=</span><span class="st">&quot;bar&quot;</span>)<span class="op">;</span></span></code></pre>
      </div>
      <div class="output display_data">
        <p>
          <img
            src="vertopal_69d537c10f7446b58861e707add3c6df/32494d3d9ae1e5705459023ad48da747d0c321b0.png"
          />
        </p>
      </div>
    </div>
  </body>
</html>
